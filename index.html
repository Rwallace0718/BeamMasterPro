
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BeamMaster Pro</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <script>
        // 1. Global State & Shims
        window.process = { env: { API_KEY: "" } };
        window.debugLogs = ["System: Monitor Started"];
        
        // 2. Logging Hijack
        const _log = console.log;
        const _err = console.error;
        console.log = (...args) => {
            window.debugLogs.push("[LOG] " + args.join(" "));
            _log.apply(console, args);
        };
        console.error = (...args) => {
            window.debugLogs.push("[ERR] " + args.join(" "));
            _err.apply(console, args);
        };

        // 3. Catch Resource Failures (Critical for mobile CDNs)
        window.addEventListener('error', (e) => {
            const msg = e.message || "Resource load failed";
            console.error(msg + (e.filename ? " at " + e.filename : ""));
            const status = document.getElementById('status-text');
            if (status) status.innerText = "System Error: Check Debug Log";
        }, true);

        let tapCount = 0;
        function handleDebugTap() {
            tapCount++;
            if (tapCount >= 5) {
                const logEl = document.getElementById('debug-console');
                if (logEl) {
                    logEl.style.display = 'block';
                    document.getElementById('debug-content').innerText = window.debugLogs.join("\n");
                }
            }
        }

        // Auto-update status text if JS starts
        setTimeout(() => {
            const status = document.getElementById('status-text');
            if (status && status.innerText === "Initializing BeamMaster") {
                status.innerText = "Connecting to Laser Modules...";
            }
        }, 2000);
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root { --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom); }
        html, body { margin: 0; padding: 0; background-color: #0f172a; color: #f8fafc; height: 100%; width: 100%; overflow: hidden; font-family: sans-serif; }
        #root { height: 100%; width: 100%; }
        #debug-console {
            display: none; position: fixed; inset: 10px; background: #000;
            color: #0f0; z-index: 10000; padding: 15px; overflow: auto;
            font-family: monospace; font-size: 11px; border: 1px solid #333; border-radius: 8px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .spinner { width: 50px; height: 50px; border: 3px solid #1e293b; border-top-color: #f97316; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; cursor: pointer; }
    </style>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "@google/genai": "https://esm.sh/@google/genai@1.3.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="debug-console">
        <div style="display:flex; justify-content:space-between; border-bottom:1px solid #333; padding-bottom:5px; margin-bottom:10px;">
            <b style="color:#fff">DIAGNOSTIC CONSOLE</b>
            <button onclick="document.getElementById('debug-console').style.display='none'" style="color:#fff; background:#444; border:0; padding:2px 8px; border-radius:4px;">CLOSE</button>
        </div>
        <pre id="debug-content"></pre>
    </div>

    <div id="root">
        <div style="display: flex; height: 100vh; width: 100%; align-items: center; justify-content: center;">
            <div style="text-align: center;">
                <div class="spinner" onclick="handleDebugTap()"></div>
                <p id="status-text" style="font-weight: 600; color: #94a3b8;">Initializing BeamMaster</p>
                <p style="font-size: 10px; margin-top: 10px; color: #334155; text-transform: uppercase; letter-spacing: 0.1em;">Tap circle 5 times for diagnostics</p>
                
                <button onclick="window.location.reload()" style="margin-top: 30px; font-size: 11px; color: #475569; border-bottom: 1px solid #1e293b; padding: 2px 5px;">Force Restart Hardware</button>
            </div>
        </div>
    </div>
<script type="module" src="/index.tsx"></script>
</body>
</html>
